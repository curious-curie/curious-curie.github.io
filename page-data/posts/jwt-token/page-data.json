{"componentChunkName":"component---src-templates-post-template-js","path":"/posts/jwt-token","result":{"data":{"markdownRemark":{"id":"abdaa9b9-a49f-518b-8553-54187620d56a","html":"<h1 id=\"jwt--토큰-저장소\" style=\"position:relative;\"><a href=\"#jwt--%ED%86%A0%ED%81%B0-%EC%A0%80%EC%9E%A5%EC%86%8C\" aria-label=\"jwt  토큰 저장소 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>JWT &#x26; 토큰 저장소</h1>\n<p>JWT: Json Web Tokens</p>\n<ul>\n<li>Self-contained: 토큰에 대한 기본정보, 전달할 정보, 토큰이 검증 되었다는 증명인 signature 포함</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token string\">\"dBjftJeZ4CVP.mB92K27uhbUJU1p1r.wW1gFWFOEjXk…\"</span></code></pre></div>\n<p>이런 토큰의 형태를 디코딩하면:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token punctuation\">{</span>\n  <span class=\"token string\">\"iss\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"http://galaxies.com\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"exp\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1300819380</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"scopes\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"explorer\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"solar-harvester\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"seller\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"sub\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"tom@andromeda.com\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>sub(subject): 이 사람이 누구인지</li>\n<li>scopes(접근범위): 이 토큰을 가지고 어디에 접근할 수 있는지</li>\n<li>exp: 언제 만료되는지</li>\n<li>iss(issuer): 누가 이 토큰을 발급했는지</li>\n</ul>\n<h3 id=\"어디에-저장해야-할까\" style=\"position:relative;\"><a href=\"#%EC%96%B4%EB%94%94%EC%97%90-%EC%A0%80%EC%9E%A5%ED%95%B4%EC%95%BC-%ED%95%A0%EA%B9%8C\" aria-label=\"어디에 저장해야 할까 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>어디에 저장해야 할까?</h3>\n<ul>\n<li>HTML5 Web Storage (local/session)</li>\n<li>쿠키</li>\n<li>Web Storage 저장</li>\n</ul>\n<p>더 간단한 방법.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\">localStorage<span class=\"token punctuation\">.</span><span class=\"token function\">setItem</span><span class=\"token punctuation\">(</span><span class=\"token string\">'access_token'</span><span class=\"token punctuation\">,</span>response<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span>access_token<span class=\"token punctuation\">)</span></code></pre></div>\n<p>보안 상 문제: 사이트에서 동작하는 자바스크립트 사용해서 접근할 수 있다</p>\n<p>XSS (cross-site scripting)에 취약할 수 있다</p>\n<p>누군가가 내 페이지에서 동작하는 자바스크립트를 삽입하면 보안상 문제 발생할 수 있음 </p>\n<blockquote>\n<p>Web Storage does not enforce any secure standards during transfer. Whoever reads Web Storage and uses it must do their due diligence to ensure they always send the JWT over HTTPS and never HTTP.</p>\n</blockquote>\n<ul>\n<li>쿠키에 저장</li>\n</ul>\n<p>Set-Cookie</p>\n<p>js-cookies 같은 라이브러리 사용</p>\n<p>보안:</p>\n<p>HttpOnly cookie flag와 함께 사용하면 자바스크립트로 접근 불가능하고 XSS도 막을 수 있음. 전통적으로 쿠키의 상태는 서버에 저장되어야 했으나 JWT는 그럴 필요가 없다고 함</p>\n<blockquote>\n<p>Cookies as a storage mechanism do not require state to be stored on the server if you are storing a JWT in the cookie. This is because the JWT encapsulates everything the server needs to serve the request.</p>\n</blockquote>\n<p>CSRF(Cross-site request forgery) 공격에 취약함 </p>\n<ul>\n<li>\n<p>실제 사용자가 의도하지 않은 request를 보내느 방식의 취약점 공격 방식</p>\n<ul>\n<li>사용자가 A 사이트에 가입되어있고 로그인 유지하고 있을 때 악성 공격을 하는 B사이트에 접속하면 스크립트를 통해 사용자 몰래 A에 악의적인 요청을 보내는 방식</li>\n</ul>\n</li>\n<li>XSS는 사용자를 믿는 점에 대한 취약점을 노리는 반면 CSRF는 사용자의 browser를 신뢰하는 것에 대한 취약점을 노려서 공격</li>\n</ul>\n<h3 id=\"옵션-설정-통해-자바스크립트-조작-방지\" style=\"position:relative;\"><a href=\"#%EC%98%B5%EC%85%98-%EC%84%A4%EC%A0%95-%ED%86%B5%ED%95%B4-%EC%9E%90%EB%B0%94%EC%8A%A4%ED%81%AC%EB%A6%BD%ED%8A%B8-%EC%A1%B0%EC%9E%91-%EB%B0%A9%EC%A7%80\" aria-label=\"옵션 설정 통해 자바스크립트 조작 방지 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>옵션 설정 통해 자바스크립트 조작 방지</h3>\n<ul>\n<li>HttpOnly: 자바스크립트로 접근 불가 (XSS 공격 방어)</li>\n<li>Secure 옵션: HTTPS 통신</li>\n</ul>\n<h3 id=\"csrf에-대응하기-위해-synchronizer-token-쓸-필요성-\" style=\"position:relative;\"><a href=\"#csrf%EC%97%90-%EB%8C%80%EC%9D%91%ED%95%98%EA%B8%B0-%EC%9C%84%ED%95%B4-synchronizer-token-%EC%93%B8-%ED%95%84%EC%9A%94%EC%84%B1-\" aria-label=\"csrf에 대응하기 위해 synchronizer token 쓸 필요성  permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>CSRF에 대응하기 위해 ‘Synchronizer Token’ 쓸 필요성 ???</h3>\n<p>CSRF 토큰을 만들어서 double checking을 통해 보안에 신경 쓸 필요가 있다.</p>\n<p>CSRF 토큰을 서버사이드에서 제공해주어야 (Per-reqeust 토큰)</p>\n<p>쿠키 통해서 요청 가면 안되고, request header에 넣어 요청하거나 hidden field로 요청</p>\n<p>custom request header 사용하는게 더 안전</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>form</span> <span class=\"token attr-name\">action</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>/transfer.do<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">method</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>post<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>hidden<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>CSRFToken<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>OWY4NmQwODE4ODRjN2Q2NTlhMmZlYWEwYzU1YWQwMTVhM2JmNGYxYjJiMGI4MjJjZDE1ZDZMGYwMGEwOA==<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n[...]\n</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>form</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>Curie Yoo</p>","fields":{"slug":"/posts/jwt-token","tagSlugs":["/tag/jwt/","/tag/cookie/","/tag/web-development/"]},"frontmatter":{"date":"2020-04-16T22:40:32.169Z","description":"JWT는 뭐고, 토큰은 어디에 저장해야 할까?","tags":["JWT","Cookie","Web Development"],"title":"JWT 토큰 + 어디에 저장할까?","socialImage":""}}},"pageContext":{"slug":"/posts/jwt-token"}},"staticQueryHashes":["251939775","2703480616","401334301"]}